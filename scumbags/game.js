var Scumbag;(function(Scumbag){function createPages(rawData,actorName,mapKey,regions){let pages=[];let rawPages=rawData.split("@");for(let i=0;i<rawPages.length-1;i++){pages[i]=new Page;let rawPage=rawPages[i+1];let conditions=rawPage.substr(0,rawPage.indexOf("\n")).split(",");let values=rawPage.substr(rawPage.indexOf("\n"),rawPage.indexOf("$")-rawPage.indexOf("\n")).split("\n");pages[i].script=rawPage.substr(rawPage.indexOf("$")+1);for(let u=0;u<conditions.length;u++){let parts=conditions[u].split(" ");if(parts[0]=="s")pages[i].switches.push(parts[1]);if(parts[0]=="ss")pages[i].switches.push(mapKey+"-"+actorName+"-"+parts[1]);if(parts[0]=="v")pages[i].variables.push({name:parts[1],threshold:parseInt(parts[2])})}for(let u=0;u<values.length;u++){let name=values[u].substr(0,values[u].indexOf(" "));let value=values[u].substr(values[u].indexOf(" ")+1);if(value.length<1)continue;if(name=="path"){pages[i].path=Scumbag.stringToMovements(JSON.parse(value),regions)}else pages[i][name]=JSON.parse(value)}}return pages}Scumbag.createPages=createPages;let MovementMode;(function(MovementMode){MovementMode[MovementMode["PermanentPath"]=0]="PermanentPath";MovementMode[MovementMode["TemporaryPath"]=1]="TemporaryPath";MovementMode[MovementMode["PlayerControlled"]=2]="PlayerControlled"})(MovementMode=Scumbag.MovementMode||(Scumbag.MovementMode={}));class Page{constructor(){this.switches=[];this.variables=[];this.key="";this.moveOnSpot=false;this.touch=false;this.autorun=false;this.spooky=false;this.moveSpeed=100;this.path=[];this.script=""}evaluatePermissions(){for(let i=0;i<this.switches.length;i++){if(!Scumbag.StateOfGame.parameters.switches[this.switches[i]])return false}for(let i=0;i<this.variables.length;i++){if(!(Scumbag.StateOfGame.parameters.variables[this.variables[i].name]>=this.variables[i].threshold)){return false}}return true}}Scumbag.Page=Page;class Actor extends Phaser.Sprite{constructor(game,x,y,name,pages){super(game,x,y,pages[0].key);this.updating=true;this.waiting=false;this.waitTime=0;this.autoran=false;this.moveMode=MovementMode.PermanentPath;this.page=-1;this.name=name;this.pages=pages;this.game.physics.arcade.enable(this);this.body.collideWorldBounds=true;this.body.game.add.existing(this);this.evaluatePages()}update(){Scumbag.Util.slow(this.body.velocity);if(!this.updating){if(!this.getPage().moveOnSpot)this.animations.stop();return}this.evaluateNextPage();this.move();let angle=Math.atan2(this.body.velocity.y,this.body.velocity.x);if(this.body.velocity.x!=0||this.body.velocity.y!=0||this.getPage().moveOnSpot){if(angle<0)this.animations.play("back");else this.animations.play("front");if(Math.abs(angle)<Math.PI/2)this.scale.x=1;else if(Math.abs(angle)>Math.PI/2)this.scale.x=-1}else this.animations.stop();if(this.getPage().autorun&&!this.autoran){Scumbag.Script.setScript(this.getPage().script,this);this.autoran=true}}move(){if(this.getPage().path.length==0&&(this.moveMode==MovementMode.PermanentPath||this.moveMode==MovementMode.TemporaryPath)||this.waiting){return}if(this.moveMode==MovementMode.PlayerControlled){let input=Scumbag.InputManager.getInputDevice(0);this.body.velocity.x=input.getAxisState(0)*this.getPage().moveSpeed;this.body.velocity.y=input.getAxisState(1)*this.getPage().moveSpeed}else{let move=this.getPage().path[0];if(move.type==Scumbag.MovementType.Wait){this.waitTime-=this.game.time.elapsedMS;if(this.waitTime<=0)this.nextMovement()}else if(move.type==Scumbag.MovementType.Towards){this.waitTime-=this.game.time.elapsedMS;if(this.waitTime<=0)this.nextMovement();else{let state=this.game.state.getCurrentState();if(state instanceof Scumbag.Overworld){let actor=state.getActorByName(move.actorName);this.moveTowardPoint(actor.position)}}}else if(move.type==Scumbag.MovementType.Angle){this.waitTime-=this.game.time.elapsedMS;if(this.waitTime<=0)this.nextMovement();else{this.body.velocity.x=this.getPage().moveSpeed*Math.cos(move.angle);this.body.velocity.y=this.getPage().moveSpeed*Math.sin(move.angle)}}else if(this.getPage().path[0].type==Scumbag.MovementType.Walk)this.pathMove()}}moveTowardPoint(point){let angle=Math.atan2(point.y-this.y,point.x-this.x);this.body.velocity.x=this.getPage().moveSpeed*Math.cos(angle);this.body.velocity.y=this.getPage().moveSpeed*Math.sin(angle)}pathMove(){if(this.x>this.getPage().path[0].region.x&&this.x<this.getPage().path[0].region.x+this.getPage().path[0].region.width&&this.y>this.getPage().path[0].region.y&&this.y<this.getPage().path[0].region.y+this.getPage().path[0].region.height){this.nextMovement();return}let targetX=this.getPage().path[0].region.x+this.getPage().path[0].region.width/2;let targetY=this.getPage().path[0].region.y+this.getPage().path[0].region.height/2;this.moveTowardPoint({x:targetX,y:targetY})}nextMovement(){if(this.moveMode==MovementMode.PermanentPath){this.getPage().path.push(this.getPage().path[0])}this.getPage().path.splice(0,1);if(this.getPage().path.length==0)return;this.waitTime=this.getPage().path[0].waitTime}setKey(key){this.getPage().key=key;if(key=="")this.alpha=0;else this.loadTexture(this.getPage().key)}setPathFromString(newPath,regions){this.getPage().path=Scumbag.stringToMovements(newPath,regions)}getPage(){return this.pages[this.page]}evaluatePages(){let oldPage=this.page;for(let i=this.page+1;i<this.pages.length;i++){if(!this.pages[i].evaluatePermissions())break;this.page=i}if(this.page==-1)this.kill();else if(oldPage!=this.page)this.beginPage()}evaluateNextPage(){if(this.page>=this.pages.length-1)return;if(this.pages[this.page+1].evaluatePermissions()){this.page++;this.beginPage()}}beginPage(){if(this.getPage().key=="")this.kill();this.loadTexture(this.getPage().key);this.body.width=this.width/5*4;this.body.height=this.height/12*5;this.body.offset.x=this.width/10;this.body.offset.y=this.height/12*7;this.anchor.setTo(.5,1);this.animations.add("front",[0,1,2,3],10,true);this.animations.add("back",[4,5,6,7],10,true);this.body.immovable=true;if(this.getPage().spooky)this.blendMode=PIXI.blendModes.SCREEN;if(this.getPage().path.length>0){this.moveMode=MovementMode.PermanentPath}this.autoran=false}}Scumbag.Actor=Actor})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class Background{constructor(imageKey,width,height,game){this.image=game.add.image(0,0,imageKey);this.image.sendToBack();this.width=width;this.height=height;this.cameraWidth=game.width;this.cameraHeight=game.height}update(cameraX,cameraY){let x=cameraX/(this.width-this.cameraWidth)*(this.width-this.image.width);let y=cameraY/(this.height-this.cameraHeight)*(this.height-this.image.height);if(isFinite(x))this.image.x=x;if(isFinite(y))this.image.y=y}}Scumbag.Background=Background})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class Bullet extends Phaser.Sprite{constructor(game,key,deathGun,deathSpawn){super(game,0,0,key);this.tracking=false;this.collide=true;this.bouncy=false;this.scaleSpeed=0;this.power=1;this.anchor.set(.5);this.checkWorldBounds=true;this.outOfBoundsKill=true;this.exists=false;this.deathGun=deathGun;this.deathSpawn=deathSpawn}fire(x,y,angle,speed,gx,gy,lifespan){this.reset(x,y);this.scale.set(1);this.game.physics.arcade.velocityFromRotation(angle,speed,this.body.velocity);this.angle=angle;this.body.gravity.set(gx,gy);this.lifespan=lifespan}update(){if(this.tracking){this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)}if(this.scaleSpeed>0){this.scale.x+=this.scaleSpeed;this.scale.y+=this.scaleSpeed}}kill(){if(this.deathGun!=undefined)this.deathGun.fire(this);if(this.deathSpawn!=null){let state=this.game.state.getCurrentState();if(state instanceof Scumbag.Fight)state.addFighter(this.deathSpawn,this.x,this.y)}return super.kill()}}Scumbag.Bullet=Bullet})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Enemies;(function(Enemies){function getEnemyData(type,game){let data=game.cache.getJSON("enemies").enemies;for(let i=0;i<data.length;i++){if(data[i].name==type)return data[i]}return null}Enemies.getEnemyData=getEnemyData})(Enemies=Scumbag.Enemies||(Scumbag.Enemies={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){const BASE_GRAVITY=400;function createFighterFromEnemy(type,x,y,mandatory,bulletGroup,game){let data=Scumbag.Enemies.getEnemyData(type,game);let fighter=new Fighter(game,x,y,data.key,data.directional);fighter.name=type;fighter.controller=new Scumbag.Controllers[data.controller](game);fighter.weapons[Scumbag.WeaponSlot.Left]=new Scumbag.Weapon(game,bulletGroup,fighter,data.lWeapon);fighter.weapons[Scumbag.WeaponSlot.Right]=new Scumbag.Weapon(game,bulletGroup,fighter,data.rWeapon);fighter.maxHealth=data.health;fighter.health=data.health;fighter.healthRegenRate=data.healthRegen;fighter.maxMana=data.mana;fighter.mana=data.mana;fighter.manaRegenRate=data.manaRegen;fighter.collisionDamage=data.collisionDamage;fighter.body.gravity.y=BASE_GRAVITY*data.gravity;fighter.jumpHeight=BASE_GRAVITY*data.jump;fighter.moveSpeed=data.moveSpeed;if(fighter.moveSpeed==0)fighter.body.immovable=true;fighter.deathWeapon=new Scumbag.Weapon(game,bulletGroup,fighter,data.deathWeapon);fighter.deathSound=data.deathSound;fighter.mandatory=mandatory;return fighter}Scumbag.createFighterFromEnemy=createFighterFromEnemy;class Fighter extends Phaser.Sprite{constructor(game,x,y,key,directional){super(game,x,y,key);this.game.physics.arcade.enable(this);this.body.collideWorldBounds=true;this.body.onWorldBounds=new Phaser.Signal;this.body.onWorldBounds.add(function(){this.kill()},this);if(directional){this.animations.add("up",[0,1,2],10,true);this.animations.add("upright",[3,4,5],10,true);this.animations.add("right",[6,7,8],10,true);this.animations.add("downright",[9,10,11],10,true);this.animations.add("down",[12,13,14],10,true)}else{this.animations.add("up",null,10,true);this.animations.add("upright",null,10,true);this.animations.add("right",null,10,true);this.animations.add("downright",null,10,true);this.animations.add("down",null,10,true)}this.directional=directional;this.weapons=[];this.weapons.length=Scumbag.WeaponSlot.nWeaponSlots;this.prevTime=this.game.time.time;this.anchor.setTo(.5,.5);game.add.existing(this)}update(){if(!(this.alive&&this.inCamera))return;let newTime=this.game.time.time;let elapsedTime=newTime-this.prevTime;if(this.health<this.maxHealth)this.health+=this.healthRegenRate;if(this.mana<this.maxMana)this.mana+=this.manaRegenRate;this.controller.control(this);let animationAngle=this.angle;if(animationAngle>Math.PI/2||animationAngle<0-Math.PI/2){this.scale.x=-1;if(animationAngle>0)animationAngle=(animationAngle-Math.PI)*-1;else animationAngle=(animationAngle+Math.PI)*-1}else{this.scale.x=1}if(animationAngle>3*Math.PI/8)this.animations.play("down");else if(animationAngle>Math.PI/8)this.animations.play("downright");else if(animationAngle>0-Math.PI/8)this.animations.play("right");else if(animationAngle>0-3*Math.PI/8)this.animations.play("upright");else this.animations.play("up");if(this.body.velocity.x==0&&this.directional){this.animations.currentAnim.stop()}}kill(){this.game.sound.play(this.deathSound);this.deathWeapon.fire(this);return super.kill()}move(angle){this.angle=angle;this.body.velocity.x=this.moveSpeed*Math.cos(angle)}fly(angle){this.angle=angle;this.body.velocity.x=this.moveSpeed*Math.cos(angle);this.body.velocity.y=this.moveSpeed*Math.sin(angle)}look(angle){this.angle=angle}jump(){if(this.body.blocked.down){this.body.velocity.y=0-this.jumpHeight}if(this.body.blocked.left){this.body.velocity.x+=this.jumpHeight/2;this.body.velocity.y=0-this.jumpHeight}if(this.body.blocked.right){this.body.velocity.x-=this.jumpHeight/2;this.body.velocity.y=0-this.jumpHeight}}attack(slot){let currentTime=this.game.time.time;if(currentTime<this.canFireTime||this.mana<this.weapons[slot].manaCost)return;this.weapons[slot].fire(this);this.canFireTime=currentTime+this.weapons[slot].wait;this.mana-=this.weapons[slot].manaCost}}Scumbag.Fighter=Fighter})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class Game extends Phaser.Game{constructor(){super(832,396,Phaser.AUTO,"content",null,false,false);this.state.add("Boot",Scumbag.Boot,false);this.state.add("Preloader",Scumbag.Preloader,false);this.state.add("MainMenu",Scumbag.MainMenu,false);this.state.add("Fight",Scumbag.Fight,false);this.state.add("Overworld",Scumbag.Overworld,false);this.state.add("Gameover",Scumbag.Gameover,false);this.state.add("Credits",Scumbag.Credits,false);this.state.start("Boot")}}Scumbag.Game=Game})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let MovementType;(function(MovementType){MovementType[MovementType["Walk"]=0]="Walk";MovementType[MovementType["Wait"]=1]="Wait";MovementType[MovementType["Towards"]=2]="Towards";MovementType[MovementType["Angle"]=3]="Angle"})(MovementType=Scumbag.MovementType||(Scumbag.MovementType={}));function printMovementType(move){if(move==MovementType.Walk)console.log("walk");else if(move==MovementType.Wait)console.log("wait");else if(move==MovementType.Towards)console.log("towards");else if(move==MovementType.Angle)console.log("angle")}Scumbag.printMovementType=printMovementType;function stringToMovement(data,regions){if(data.charAt(0)=="#"){return{type:MovementType.Wait,waitTime:parseInt(data.substring(1)),region:regions[0],actorName:"",angle:0}}else if(data.charAt(0)=="&"){var tokens=data.substring(1).split("#");return{type:MovementType.Towards,waitTime:parseInt(tokens[1]),region:regions[0],actorName:tokens[0],angle:0}}else if(data.charAt(0)=="^"){var tokens=data.substring(1).split("#");return{type:MovementType.Angle,waitTime:parseInt(tokens[1]),region:regions[0],actorName:"",angle:Scumbag.Util.evaluateDirection(tokens[0])}}else return{type:MovementType.Walk,waitTime:0,region:regions[data],actorName:"",angle:0}}Scumbag.stringToMovement=stringToMovement;function stringToMovements(data,regions){let pathNames=data.split(",");let path=[];for(let u in pathNames)path.push(stringToMovement(pathNames[u],regions));return path}Scumbag.stringToMovements=stringToMovements})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let MusicChannel;(function(MusicChannel){MusicChannel[MusicChannel["Music"]=0]="Music";MusicChannel[MusicChannel["Ambience"]=1]="Ambience";MusicChannel[MusicChannel["NChannels"]=2]="NChannels"})(MusicChannel=Scumbag.MusicChannel||(Scumbag.MusicChannel={}));let MusicManager;(function(MusicManager){let currentSongKey=new Array(MusicChannel.NChannels);let currentSong=new Array(MusicChannel.NChannels);function playSong(game,key,channel){if(currentSongKey[channel]==key)return;if(currentSongKey[channel]!=null){game.sound.removeByKey(currentSongKey[channel])}currentSongKey[channel]=key;currentSong[channel]=game.add.audio(key,1,true);currentSong[channel].play()}MusicManager.playSong=playSong;function stopSong(channel){if(currentSong[channel]!=null){currentSong[channel].destroy();currentSongKey[channel]=null}}MusicManager.stopSong=stopSong})(MusicManager=Scumbag.MusicManager||(Scumbag.MusicManager={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){function createRegions(data){let regions={};for(let i=0;i<data.length;i++){let name=data[i].name;let x=data[i].x;let y=data[i].y;let width=data[i].width;let height=data[i].height;let script=null;if(data[i].hasOwnProperty("properties")){if(data[i].properties.hasOwnProperty("script")){script=data[i].properties.script}}regions[name]={x:x,y:y,width:width,height:height,script:script}}return regions}Scumbag.createRegions=createRegions})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let SaveManager;(function(SaveManager){function saveGame(slot,data){if(typeof Storage!=="undefined"){localStorage.setItem("save"+slot,data)}else{console.log("I'm afraid saving won't be possible in this browser, but"+" here's what it was going to save:");console.log(data)}}SaveManager.saveGame=saveGame;function loadGame(slot){if(typeof Storage!=="undefined"){return localStorage.getItem("save"+slot)}else{console.log("I'm afraid loading won't be possible in this browser")}}SaveManager.loadGame=loadGame})(SaveManager=Scumbag.SaveManager||(Scumbag.SaveManager={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let StateOfGame;(function(StateOfGame){function flush(){StateOfGame.parameters={slot:0,switches:{},variables:{},characters:[],map:"",playerKey:"",actors:new Array,score:0,time:0}}StateOfGame.flush=flush;let timerFunction=0;function startTimer(){timerFunction=setInterval(function(){StateOfGame.parameters.time++;StateOfGame.parameters.score-=.135},1e3)}StateOfGame.startTimer=startTimer;function stopTimer(){clearInterval(timerFunction)}StateOfGame.stopTimer=stopTimer;function save(){let data=JSON.stringify(StateOfGame.parameters);if(typeof Storage!=="undefined"){localStorage.setItem("save"+StateOfGame.parameters.slot,data)}else{console.log("I'm afraid saving won't be possible in this browser, but"+" here's what it was going to save:");console.log(data)}}StateOfGame.save=save;function load(slot){if(typeof Storage!=="undefined"){let data=localStorage.getItem("save"+slot);if(data!=null)StateOfGame.parameters=JSON.parse(data);else{console.log("oing the other way");flush();StateOfGame.parameters.slot=slot}}else{console.log("I'm afraid loading won't be possible in this browser")}StateOfGame.parameters.slot=slot}StateOfGame.load=load})(StateOfGame=Scumbag.StateOfGame||(Scumbag.StateOfGame={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){const generatorConstructor=Object.getPrototypeOf(function*(){}).constructor;let game;let blocks;let paused=false;function storeActor(actor){Scumbag.StateOfGame.parameters.actors.push({name:actor.name,x:actor.x,y:actor.y})}function storeActors(){let state=game.state.getCurrentState();if(state instanceof Scumbag.Overworld){Scumbag.StateOfGame.parameters.actors=[];state.actors.forEach(storeActor,null)}}let ScriptContext;(function(ScriptContext){function changeState(newState,...args){game.state.start(newState,true,false,args)}ScriptContext.changeState=changeState;function transport(level,playerRegion){game.state.start("Overworld",true,false,level,playerRegion)}ScriptContext.transport=transport;function*startFight(map){storeActors();paused=true;ScriptContext.state.transition(map)}ScriptContext.startFight=startFight;function toOverworld(){game.state.start("Overworld")}ScriptContext.toOverworld=toOverworld;function setSwitch(key,value){Scumbag.StateOfGame.parameters.switches[key]=value}ScriptContext.setSwitch=setSwitch;function getSwitch(key){if(key in Scumbag.StateOfGame.parameters.switches)return Scumbag.StateOfGame.parameters.switches[key];else return false}ScriptContext.getSwitch=getSwitch;function setVariable(key,value){Scumbag.StateOfGame.parameters.variables[key]=value}ScriptContext.setVariable=setVariable;function getVarirable(key){if(key in Scumbag.StateOfGame.parameters.variables)return Scumbag.StateOfGame.parameters.variables[key];else return 0}ScriptContext.getVarirable=getVarirable;function saveGame(){storeActors();Scumbag.StateOfGame.save()}ScriptContext.saveGame=saveGame;function loadGame(slot){Scumbag.StateOfGame.load(slot)}ScriptContext.loadGame=loadGame;function addCharacter(character){Scumbag.StateOfGame.parameters.characters.push(character)}ScriptContext.addCharacter=addCharacter;function getCharacters(){return Scumbag.StateOfGame.parameters.characters}ScriptContext.getCharacters=getCharacters;function setPlayerKey(key){if(this.state instanceof Scumbag.Overworld)this.state.player.setKey(key);Scumbag.StateOfGame.parameters.playerKey=key}ScriptContext.setPlayerKey=setPlayerKey;function playSound(key){game.sound.play(key)}ScriptContext.playSound=playSound;function playAmbience(key){Scumbag.MusicManager.playSong(game,key,Scumbag.MusicChannel.Ambience)}ScriptContext.playAmbience=playAmbience;function playMusic(key){Scumbag.MusicManager.playSong(game,key,Scumbag.MusicChannel.Music)}ScriptContext.playMusic=playMusic;function stopMusic(){Scumbag.MusicManager.stopSong(Scumbag.MusicChannel.Music)}ScriptContext.stopMusic=stopMusic;function setSlot(slot){Scumbag.StateOfGame.parameters.slot=slot}ScriptContext.setSlot=setSlot;function getSlot(){return Scumbag.StateOfGame.parameters.slot}ScriptContext.getSlot=getSlot;function getScore(){return Scumbag.StateOfGame.parameters.score}ScriptContext.getScore=getScore;function win(){game.state.start("Credits")}ScriptContext.win=win})(ScriptContext||(ScriptContext={}));let Script;(function(Script){function init(pGame){game=pGame}Script.init=init;function setScript(content,caller){paused=false;ScriptContext.state=game.state.getCurrentState();ScriptContext.caller=caller;blocks=generatorConstructor("ctx",game.cache.getText("stdScript")+content)(ScriptContext);runScript(0)}Script.setScript=setScript;function runScript(value){blocks.next(value)}Script.runScript=runScript;function checkPaused(){if(paused){paused=false;return true}return false}Script.checkPaused=checkPaused;function clearPause(){paused=false}Script.clearPause=clearPause})(Script=Scumbag.Script||(Scumbag.Script={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Util;(function(Util){function slow(value){if(value.x>1)value.x=1;else if(value.x<-1)value.x=-1;else value.x=0;if(value.y>1)value.y=1;else if(value.y<-1)value.y=-1;else value.y=0}Util.slow=slow;function evaluateDirection(direction){if(direction=="up")return Math.PI/2;else if(direction=="left")return Math.PI;else if(direction=="down")return-1*Math.PI/2;else if(direction=="right")return 0;else return parseInt(direction)}Util.evaluateDirection=evaluateDirection})(Util=Scumbag.Util||(Scumbag.Util={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let num=0;function getWeaponData(type,game){let data=game.cache.getJSON("weapons").weapons;for(let i=0;i<data.length;i++){if(data[i].name==type)return data[i]}return null}function inRange(min,max){return Math.random()*(max-min)+min}class Weapon extends Phaser.Group{constructor(game,parent,master,type){super(game,parent,"G"+num++,false,true,Phaser.Physics.ARCADE);this.master=master;let data=getWeaponData(type,game);this.speed=data.speed;this.gx=data.gx;this.gy=data.gy;this.lifespan=data.lifespan;this.wait=data.wait;this.manaCost=data.manaCost;this.accuracy=data.accuracy;this.sound=data.sound;this.cluster=data.cluster;let subMaster=null;let deathWeapon=null;if(data.passOnMaster)subMaster=master;if(data.deathWeapon!=null){deathWeapon=new Weapon(game,parent,subMaster,data.deathWeapon)}for(let i=0;i<data.nBullets;i++){this.add(new Scumbag.Bullet(game,data.key,deathWeapon,data.deathSpawn),true)}for(let i=0;i<data.setAll.length;i++){this.setAll(data.setAll[i][0],data.setAll[i][1])}}fire(source){if(this.sound!=null)this.game.sound.play(this.sound);for(let i=0;i<this.cluster;i++){let bullet=this.getFirstExists(false);if(bullet!=null){let angle=source.angle+(Math.random()*Math.PI*2-Math.PI)*this.accuracy;let speed=inRange(this.speed[0],this.speed[1]);let gx=inRange(this.gx[0],this.gx[1]);let gy=inRange(this.gy[0],this.gy[1]);let lifespan=inRange(this.lifespan[0],this.lifespan[1]);bullet.fire(source.x,source.y,angle,speed,gx,gy,lifespan)}}}}Scumbag.Weapon=Weapon})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class Controller{constructor(game){this.game=game}}Scumbag.Controller=Controller;let WeaponSlot;(function(WeaponSlot){WeaponSlot[WeaponSlot["Left"]=0]="Left";WeaponSlot[WeaponSlot["Right"]=1]="Right";WeaponSlot[WeaponSlot["nWeaponSlots"]=2]="nWeaponSlots"})(WeaponSlot=Scumbag.WeaponSlot||(Scumbag.WeaponSlot={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Controllers;(function(Controllers){class BouncerController extends Scumbag.Controller{constructor(){super(...arguments);this.goLeft=false}control(controlled){let x=0,y=0;controlled.jump();if(this.goLeft)x=-1;else x=1;if(Math.random()>.96)this.goLeft=!this.goLeft;let angle=Math.atan2(y,x);controlled.move(angle);let event=Math.random();if(event<.005){this.game.sound.play(controlled.deathSound)}else if(event>.6){let state=controlled.game.state.getCurrentState();if(state instanceof Scumbag.Fight){let player=state.player;if(!player.alive)return;let angle=Math.atan2(player.body.y-controlled.body.y,player.body.x-controlled.body.x);controlled.move(angle)}}}}Controllers.BouncerController=BouncerController})(Controllers=Scumbag.Controllers||(Scumbag.Controllers={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Controllers;(function(Controllers){class KubusController extends Scumbag.Controller{control(controlled){if(this.jumping>0){controlled.move(this.angle);this.jumping-=this.game.time.elapsedMS/1e3}else{let event=Math.random();controlled.body.velocity.x/=2;if(event<.02){this.game.sound.play(controlled.deathSound);this.angle=Math.random()*Math.PI*2-Math.PI;this.jumping=Math.random()*2.5;controlled.jump()}else if(event>.1){let state=controlled.game.state.getCurrentState();if(state instanceof Scumbag.Fight){let player=state.player;if(!player.alive)return;let angle=controlled.angle;controlled.angle=Math.atan2(player.body.y-controlled.body.y,player.body.x-controlled.body.x);controlled.attack(Math.floor(Math.random()*2));controlled.angle=angle}}}}}Controllers.KubusController=KubusController})(Controllers=Scumbag.Controllers||(Scumbag.Controllers={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Controllers;(function(Controllers){class MonkeyController extends Scumbag.Controller{control(controlled){controlled.body.velocity.x=0;let state=controlled.game.state.getCurrentState();if(state instanceof Scumbag.Fight){let player=state.player;if(!player.alive)return;let angle=player.angle;controlled.look(angle);controlled.attack(Scumbag.WeaponSlot.Left)}}}Controllers.MonkeyController=MonkeyController})(Controllers=Scumbag.Controllers||(Scumbag.Controllers={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Controllers;(function(Controllers){class NightweirdController extends Scumbag.Controller{constructor(){super(...arguments);this.angle=0}control(controlled){this.angle+=Math.random()-.5;controlled.fly(this.angle);let event=Math.random();if(event<.005){this.game.sound.play(controlled.deathSound)}}}Controllers.NightweirdController=NightweirdController})(Controllers=Scumbag.Controllers||(Scumbag.Controllers={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Controllers;(function(Controllers){class PacerController extends Scumbag.Controller{constructor(){super(...arguments);this.goLeft=false}control(controlled){let x=0,y=0;if(this.goLeft)x=-1;else x=1;if(Math.random()>.96)this.goLeft=!this.goLeft;let angle=Math.atan2(y,x);controlled.move(angle);if(Math.random()>.9){let state=controlled.game.state.getCurrentState();if(state instanceof Scumbag.Fight){let angle=Math.random()*Math.PI*2-Math.PI;controlled.move(angle);controlled.attack(Scumbag.WeaponSlot.Left)}}}}Controllers.PacerController=PacerController})(Controllers=Scumbag.Controllers||(Scumbag.Controllers={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Controllers;(function(Controllers){class PlayerController extends Scumbag.Controller{control(controlled){controlled.body.velocity.x=0;let x=0,y=0;{x=Scumbag.InputManager.getInputDevice(0).getAxisState(0);y=Scumbag.InputManager.getInputDevice(0).getAxisState(1);if(Math.abs(x)>.2||Math.abs(y)>.2){let angle=Math.atan2(y,x);if(Scumbag.InputManager.getInputDevice(0).getButtonState(1)){controlled.look(angle)}else{controlled.move(angle)}}}if(Scumbag.InputManager.getInputDevice(0).getButtonState(0)){controlled.jump()}if(Scumbag.InputManager.getInputDevice(0).getButtonState(8)){controlled.attack(Scumbag.WeaponSlot.Left)}else if(Scumbag.InputManager.getInputDevice(0).getButtonState(9)){controlled.attack(Scumbag.WeaponSlot.Right)}}}Controllers.PlayerController=PlayerController})(Controllers=Scumbag.Controllers||(Scumbag.Controllers={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Controllers;(function(Controllers){class RobotController extends Scumbag.Controller{control(controlled){controlled.body.velocity.x=0;let state=controlled.game.state.getCurrentState();if(state instanceof Scumbag.Fight){let player=state.player;if(!player.alive)return;let angle=Math.atan2(player.body.y-controlled.body.y,player.body.x-controlled.body.x);controlled.look(angle);controlled.attack(Scumbag.WeaponSlot.Left)}}}Controllers.RobotController=RobotController})(Controllers=Scumbag.Controllers||(Scumbag.Controllers={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Controllers;(function(Controllers){class StationaryController extends Scumbag.Controller{constructor(){super(...arguments);this.homeSet=false}control(controlled){if(!this.homeSet){this.homeX=controlled.x;this.homeY=controlled.y;this.homeSet=true}else{let angle=Math.atan2(this.homeY-controlled.body.y,this.homeX-controlled.body.x);controlled.fly(angle)}let state=controlled.game.state.getCurrentState();if(state instanceof Scumbag.Fight){let player=state.player;if(!player.alive)return;let angle=Math.atan2(player.body.y-controlled.body.y,player.body.x-controlled.body.x);controlled.look(angle);controlled.attack(Scumbag.WeaponSlot.Left)}}}Controllers.StationaryController=StationaryController})(Controllers=Scumbag.Controllers||(Scumbag.Controllers={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){const RANGE=100;let Controllers;(function(Controllers){class BurrowerController extends Scumbag.Controller{constructor(){super(...arguments);this.dig=true}control(controlled){if(this.dig){controlled.move(Math.PI/2);controlled.attack(Scumbag.WeaponSlot.Left);if(Math.random()>.99)this.dig=false}else{let state=controlled.game.state.getCurrentState();if(state instanceof Scumbag.Fight){let player=state.player;if(!player.alive)return;if(Math.abs(player.x+player.width/2-(controlled.x+controlled.width/2))<RANGE){controlled.look(0-Math.PI/2);controlled.attack(Scumbag.WeaponSlot.Right)}else{controlled.look(Math.PI/2)}}}}}Controllers.BurrowerController=BurrowerController})(Controllers=Scumbag.Controllers||(Scumbag.Controllers={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class GuiElement{constructor(blocking=true){this.blocking=blocking}}Scumbag.GuiElement=GuiElement})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){function click(){this.go=true}class BlankElement extends Scumbag.GuiElement{bringToFront(){}addPosition(x,y){}setPosition(x,y){}getX(){return 0}getY(){return 0}getWidth(){return 0}getHeight(){return 0}update(){return 0}destroy(){}}Scumbag.BlankElement=BlankElement})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){function click(){this.go=true}class ClickerElement extends Scumbag.GuiElement{constructor(game,key){super();this.go=false;this.image=game.add.image(0,0,key);Scumbag.InputManager.getInputDevice(0).addOnButtonPress(0,click,this)}bringToFront(){this.image.bringToTop()}addPosition(x,y){this.image.x+=x;this.image.y+=y}setPosition(x,y){this.image.x=x;this.image.y=y}getX(){return this.image.x}getY(){return this.image.y}getWidth(){return this.image.width}getHeight(){return this.image.height}update(){if(this.go)return 1;else return 0}destroy(){Scumbag.InputManager.getInputDevice(0).removeOnButtonPress(0,click);this.image.destroy()}}Scumbag.ClickerElement=ClickerElement})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class ImageElement extends Scumbag.GuiElement{constructor(game,key){super();this.image=game.add.image(0,0,key)}bringToFront(){this.image.bringToTop()}addPosition(x,y){this.image.x+=x;this.image.y+=y}setPosition(x,y){this.image.x=x;this.image.y=y}getX(){return this.image.x}getY(){return this.image.y}getWidth(){return this.image.width}getHeight(){return this.image.height}update(){return 0}destroy(){this.image.destroy()}}Scumbag.ImageElement=ImageElement})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){function click(){this.go=true}class SelectorElement extends Scumbag.GuiElement{constructor(game,key,children){super();this.x=-99999;this.y=-99999;this.go=false;this.selection=0;this.image=game.add.image(this.x,this.y,key);this.children=children;Scumbag.InputManager.getInputDevice(0).addOnButtonPress(0,click,this);this.oldVerticalStick=Scumbag.InputManager.getInputDevice(0).getAxisState(1);let yPadding=0;for(let i=0;i<this.children.length;i++){this.children[i].setPosition(this.image.x,this.image.y+yPadding);this.children[i].bringToFront();yPadding+=this.children[i].getHeight()*.8}}bringToFront(){this.image.bringToTop();for(let i=0;i<this.children.length;i++){this.children[i].bringToFront()}}addPosition(x,y){for(let i=0;i<this.children.length;i++){this.children[i].addPosition(x,y)}}setPosition(x,y){let deltaX=x-this.x;let deltaY=y-this.y;this.x+=deltaX;this.y+=deltaY;for(let i=0;i<this.children.length;i++){this.children[i].addPosition(deltaX,deltaY)}}getX(){return this.x}getY(){return this.y}getWidth(){return 0}getHeight(){return 0}update(){let verticalStick=Scumbag.InputManager.getInputDevice(0).getAxisState(1);if(Math.abs(this.oldVerticalStick)<.5&&Math.abs(verticalStick)>.5){if(verticalStick>0)this.selection++;else this.selection--}this.oldVerticalStick=verticalStick;if(this.selection>=this.children.length)this.selection=0;if(this.selection<0)this.selection=this.children.length-1;this.image.x=this.children[this.selection].getX();this.image.y=this.children[this.selection].getY();this.image.width=this.children[this.selection].getWidth();this.image.height=this.children[this.selection].getHeight();if(this.go)return this.selection+1;else return 0}destroy(){Scumbag.InputManager.getInputDevice(0).removeOnButtonPress(0,click);this.image.destroy();for(let i=0;i<this.children.length;i++){this.children[i].destroy()}}}Scumbag.SelectorElement=SelectorElement})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class ShelfElement extends Scumbag.GuiElement{constructor(children){super();this.x=0;this.y=0;this.children=children;let xPadding=0;for(let i=0;i<this.children.length;i++){this.children[i].setPosition(xPadding,0);this.children[i].bringToFront();xPadding+=this.children[i].getWidth()}}bringToFront(){for(let i=0;i<this.children.length;i++){this.children[i].bringToFront()}}addPosition(x,y){this.x+=x;this.y+=y;for(let i=0;i<this.children.length;i++){this.children[i].addPosition(x,y)}}setPosition(x,y){let deltaX=x-this.x;let deltaY=y-this.y;for(let i=0;i<this.children.length;i++){this.children[i].addPosition(deltaX,deltaY)}this.x=x;this.y=y}getX(){return this.x}getY(){return this.y}getWidth(){let width=0;for(let i=0;i<this.children.length;i++){width+=this.children[i].getWidth()}return width}getHeight(){let height=0;for(let i=0;i<this.children.length;i++){if(this.children[i].getHeight()>height){height=this.children[i].getHeight()}}return height}update(){for(let i=0;i<this.children.length;i++){let value=this.children[i].update();if(value!=0)return value}return 0}destroy(){for(let i=0;i<this.children.length;i++){this.children[i].destroy()}}}Scumbag.ShelfElement=ShelfElement})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){function click(){this.go=true}class SlotElement extends Scumbag.GuiElement{constructor(game,key,children){super();this.x=-99999;this.y=-99999;this.go=false;this.selection=0;this.image=game.add.image(this.x,this.y,key);this.children=children;Scumbag.InputManager.getInputDevice(0).addOnButtonPress(0,click,this);this.oldHorizontalStick=Scumbag.InputManager.getInputDevice(0).getAxisState(0);let xPadding=0;for(let i=0;i<this.children.length;i++){this.children[i].setPosition(this.image.x+xPadding,this.image.y);this.children[i].bringToFront();xPadding+=this.children[i].getWidth()*1.5}}bringToFront(){this.image.bringToTop();for(let i=0;i<this.children.length;i++){this.children[i].bringToFront()}}addPosition(x,y){for(let i=0;i<this.children.length;i++){this.children[i].addPosition(x,y)}}setPosition(x,y){let deltaX=x-this.x;let deltaY=y-this.y;this.x+=deltaX;this.y+=deltaY;for(let i=0;i<this.children.length;i++){this.children[i].addPosition(deltaX,deltaY)}}getX(){return this.x}getY(){return this.y}getWidth(){let width=0;for(let i=0;i<this.children.length;i++){width+=this.children[i].width}return width}getHeight(){let height=0;for(let i=0;i<this.children.length;i++){if(this.children[i].getHeight()>height){height=this.children[i].getHeight()}}return height}update(){let horizontalStick=Scumbag.InputManager.getInputDevice(0).getAxisState(0);if(Math.abs(this.oldHorizontalStick)<.5&&Math.abs(horizontalStick)>.5){if(horizontalStick>0)this.selection++;else this.selection--}this.oldHorizontalStick=horizontalStick;if(this.selection>=this.children.length)this.selection=0;if(this.selection<0)this.selection=this.children.length-1;this.image.x=this.children[this.selection].getX();this.image.y=this.children[this.selection].getY();this.image.width=this.children[this.selection].getWidth();this.image.height=this.children[this.selection].getHeight();if(this.go)return this.selection+1;else return 0}destroy(){Scumbag.InputManager.getInputDevice(0).removeOnButtonPress(0,click);this.image.destroy();for(let i=0;i<this.children.length;i++){this.children[i].destroy()}}}Scumbag.SlotElement=SlotElement})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class StackElement extends Scumbag.GuiElement{constructor(children){super();this.x=0;this.y=0;this.children=children;let yPadding=0;for(let i=0;i<this.children.length;i++){this.children[i].setPosition(0,yPadding);this.children[i].bringToFront();yPadding+=this.children[i].getHeight()}}bringToFront(){for(let i=0;i<this.children.length;i++){this.children[i].bringToFront()}}addPosition(x,y){this.x+=x;this.y+=y;for(let i=0;i<this.children.length;i++){this.children[i].addPosition(x,y)}}setPosition(x,y){let deltaX=x-this.x;let deltaY=y-this.y;for(let i=0;i<this.children.length;i++){this.children[i].addPosition(deltaX,deltaY)}this.x=x;this.y=y}getX(){return this.x}getY(){return this.y}getWidth(){let width=0;for(let i=0;i<this.children.length;i++){if(this.children[i].getWidth()>width){width=this.children[i].getWidth()}}return width}getHeight(){let height=0;for(let i=0;i<this.children.length;i++){height+=this.children[i].getHeight()}return height}update(){for(let i=0;i<this.children.length;i++){let value=this.children[i].update();if(value!=0)return value}return 0}destroy(){for(let i=0;i<this.children.length;i++){this.children[i].destroy()}}}Scumbag.StackElement=StackElement})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class TextElement extends Scumbag.GuiElement{constructor(game,content,style,timed=false){super();this.timer=0;this.cursor=0;this.period=.01;this.game=game;this.content=content;this.text=game.add.text(0,0,"",style);this.text.setShadow(1,1,"rgba(0,0,0,1)",4);this.timed=timed;if(!this.timed)this.text.text=content}bringToFront(){this.text.bringToTop()}addPosition(x,y){this.text.x+=x;this.text.y+=y}setPosition(x,y){this.text.x=x;this.text.y=y}getX(){return this.text.x}getY(){return this.text.y}getWidth(){return this.text.width}getHeight(){return this.text.height}update(){if(!this.timed)return 0;this.timer+=this.game.time.elapsed/1e3;while(this.timer>this.period&&this.cursor<this.content.length){this.text.text+=this.content[this.cursor];this.cursor++;this.timer-=this.period;this.game.sound.play("tick")}return 0}destroy(){this.text.destroy()}}Scumbag.TextElement=TextElement})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class Waiter extends Scumbag.GuiElement{constructor(game,actorPaths,colour=-1,time=0){super(false);this.actors=[];this.oldMoveModes=[];this.fadeDone=true;let state=game.state.getCurrentState();if(state instanceof Scumbag.Overworld){this.state=state;for(let i=0;i<actorPaths.length;i++){this.actors[i]=state.getActorByName(actorPaths[i].name);this.actors[i].getPage().path=Scumbag.stringToMovements(actorPaths[i].path,state.regions);this.oldMoveModes[i]=this.actors[i].moveMode;this.actors[i].moveMode=Scumbag.MovementMode.TemporaryPath}if(colour>=0){this.fadeDone=false;game.camera.fade(colour,time);game.camera.onFadeComplete.addOnce(function(waiter){this.camera.flash(colour,500);waiter.fadeDone=true},game,0,this)}state.player.moveMode=Scumbag.MovementMode.TemporaryPath}}bringToFront(){}addPosition(x,y){}setPosition(x,y){}getX(){return 0}getY(){return 0}getWidth(){return 0}getHeight(){return 0}update(){if(!this.fadeDone)return 0;for(let i=0;i<this.actors.length;i++){if(this.actors[i].getPage().path.length>0)return 0}return 1}destroy(){for(let i=0;i<this.actors.length;i++){this.actors[i].moveMode=this.oldMoveModes[i]}this.state.player.moveMode=Scumbag.MovementMode.PlayerControlled}}Scumbag.Waiter=Waiter})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){const padding=4;class Window extends Scumbag.GuiElement{constructor(game,key,children,chipKey){super();this.chip=null;this.children=children;this.image=game.add.image(0,game.height-game.height/4,key);this.image.width=game.width;this.image.height=game.height/4;let xPadding=padding;let yPadding=padding;if(chipKey!=null){this.chip=game.add.image(0,0,chipKey);this.chip.y=game.height-this.chip.height;xPadding+=this.chip.width}for(let i=0;i<this.children.length;i++){this.children[i].setPosition(this.image.x+xPadding,this.image.y+yPadding);this.children[i].bringToFront();yPadding+=this.children[i].getHeight()}}bringToFront(){this.image.bringToTop();for(let i=0;i<this.children.length;i++){this.children[i].bringToFront()}if(this.chip!=null)this.chip.bringToTop()}addPosition(x,y){this.image.x+=x;this.image.y+=y;if(this.chip!=null){this.chip.x+=x;this.chip.y+=y}for(let i=0;i<this.children.length;i++){this.children[i].addPosition(x,y)}}setPosition(x,y){let deltaX=x-this.image.x;let deltaY=y-this.image.y;this.image.x+=deltaX;this.image.y+=deltaY;if(this.chip!=null){this.chip.x+=deltaX;this.chip.y+=deltaY}for(let i=0;i<this.children.length;i++){this.children[i].addPosition(deltaX,deltaY)}}getX(){return this.image.x}getY(){return this.image.y}getWidth(){return this.image.width}getHeight(){return this.image.height}update(){for(let i=0;i<this.children.length;i++){let value=this.children[i].update();if(value!=0)return value}return 0}destroy(){this.image.destroy();if(this.chip!=null)this.chip.destroy();for(let i=0;i<this.children.length;i++){this.children[i].destroy()}}}Scumbag.Window=Window})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){let Button;(function(Button){Button[Button["a"]=0]="a";Button[Button["b"]=1]="b";Button[Button["x"]=2]="x";Button[Button["y"]=3]="y";Button[Button["l"]=4]="l";Button[Button["r"]=5]="r";Button[Button["select"]=6]="select";Button[Button["start"]=7]="start";Button[Button["lTrigger"]=8]="lTrigger";Button[Button["rTrigger"]=9]="rTrigger";Button[Button["nButtons"]=10]="nButtons"})(Button=Scumbag.Button||(Scumbag.Button={}));let Axis;(function(Axis){Axis[Axis["Horizontal"]=0]="Horizontal";Axis[Axis["Vertical"]=1]="Vertical";Axis[Axis["nAxes"]=2]="nAxes"})(Axis=Scumbag.Axis||(Scumbag.Axis={}));class InputDevice{}Scumbag.InputDevice=InputDevice})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class GamepadInputDevice extends Scumbag.InputDevice{constructor(pad){super();this.pad=pad;this.buttons=new Array(10);this.buttons[0]=this.pad.getButton(Phaser.Gamepad.XBOX360_A);this.buttons[1]=this.pad.getButton(Phaser.Gamepad.XBOX360_B);this.buttons[2]=this.pad.getButton(Phaser.Gamepad.XBOX360_X);this.buttons[3]=this.pad.getButton(Phaser.Gamepad.XBOX360_Y);this.buttons[4]=this.pad.getButton(Phaser.Gamepad.XBOX360_LEFT_BUMPER);this.buttons[5]=this.pad.getButton(Phaser.Gamepad.XBOX360_RIGHT_BUMPER);this.buttons[6]=this.pad.getButton(Phaser.Gamepad.XBOX360_BACK);this.buttons[7]=this.pad.getButton(Phaser.Gamepad.XBOX360_START);this.buttons[8]=this.pad.getButton(Phaser.Gamepad.XBOX360_LEFT_TRIGGER);this.buttons[9]=this.pad.getButton(Phaser.Gamepad.XBOX360_RIGHT_TRIGGER);this.axes=new Array(2);this.axes[0]=Phaser.Gamepad.XBOX360_STICK_LEFT_X;this.axes[1]=Phaser.Gamepad.XBOX360_STICK_LEFT_Y}getButtonState(button){return this.buttons[button].isDown}getAxisState(axis){let axisState=this.pad.axis(this.axes[axis]);if(!axisState)return 0;return axisState}addOnButtonPress(button,callback,context){this.buttons[button].onDown.add(callback,context)}removeOnButtonPress(button,callback,context){this.buttons[button].onDown.remove(callback,context)}clear(){for(let i=0;i<10;i++){this.buttons[i].onDown.removeAll()}}}Scumbag.GamepadInputDevice=GamepadInputDevice})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){const N_INPUT_DEVICES=1;let InputManager;(function(InputManager){let inputDevices=Array(N_INPUT_DEVICES);function init(game){let pad=game.input.gamepad.pad1;if(game.input.gamepad.supported&&game.input.gamepad.active&&pad.connected){console.log("using gamepad");inputDevices[0]=new Scumbag.GamepadInputDevice(pad)}else{console.log("using keyboard");inputDevices[0]=new Scumbag.KeyboardInputDevice(game)}}InputManager.init=init;function getInputDevice(id){return inputDevices[id]}InputManager.getInputDevice=getInputDevice})(InputManager=Scumbag.InputManager||(Scumbag.InputManager={}))})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class KeyboardInputDevice extends Scumbag.InputDevice{constructor(game){super();this.buttons=new Array(10);this.buttons[0]=game.input.keyboard.addKey(Phaser.KeyCode.SHIFT);this.buttons[1]=game.input.keyboard.addKey(Phaser.KeyCode.CONTROL);this.buttons[2]=game.input.keyboard.addKey(Phaser.KeyCode.Z);this.buttons[3]=game.input.keyboard.addKey(Phaser.KeyCode.A);this.buttons[4]=game.input.keyboard.addKey(Phaser.KeyCode.S);this.buttons[5]=game.input.keyboard.addKey(Phaser.KeyCode.X);this.buttons[8]=game.input.keyboard.addKey(Phaser.KeyCode.D);this.buttons[9]=game.input.keyboard.addKey(Phaser.KeyCode.C);this.buttons[6]=game.input.keyboard.addKey(Phaser.KeyCode.BACKSPACE);this.buttons[7]=game.input.keyboard.addKey(Phaser.KeyCode.ENTER);this.up=game.input.keyboard.addKey(Phaser.KeyCode.UP);this.down=game.input.keyboard.addKey(Phaser.KeyCode.DOWN);this.left=game.input.keyboard.addKey(Phaser.KeyCode.LEFT);this.right=game.input.keyboard.addKey(Phaser.KeyCode.RIGHT)}getButtonState(button){return this.buttons[button].isDown}getAxisState(axis){if(axis==0){if(this.left.isDown&&this.right.isDown)return 0;if(this.left.isDown)return-1;if(this.right.isDown)return 1;return 0}if(axis==1){if(this.up.isDown&&this.down.isDown)return 0;if(this.up.isDown)return-1;if(this.down.isDown)return 1;return 0}}addOnButtonPress(button,callback,context){this.buttons[button].onDown.add(callback,context)}removeOnButtonPress(button,callback,context){this.buttons[button].onDown.remove(callback,context)}clear(){for(let i=0;i<10;i++){this.buttons[i].onDown.removeAll()}}}Scumbag.KeyboardInputDevice=KeyboardInputDevice})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class Boot extends Phaser.State{preload(){this.load.image("preloadBar","images/preloadBar.png")}create(){this.input.maxPointers=1;this.stage.disableVisibilityChange=true;this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL;this.scale.pageAlignHorizontally=true;this.game.stage.smoothed=false;this.game.input.gamepad.start();this.game.state.start("Preloader",true,false)}}Scumbag.Boot=Boot})(Scumbag||(Scumbag={}));``;var Scumbag;(function(Scumbag){const headingFont={font:"16px Serif",fontStyle:"bold",fill:"#ff0"};const questionFont={font:"16px Serif",fontStyle:"bold",fill:"#f00"};const bodyFont={font:"14px Serif",fill:"#ff6"};const N_SAVES=3;function numberAsTime(time){let hrs=~~(time/3600);let mins=~~(time%3600/60);let secs=time%60;return hrs+":"+mins+":"+secs}Scumbag.numberAsTime=numberAsTime;class GuiState extends Phaser.State{constructor(){super(...arguments);this.gui=null}create(){this.gui=null}update(){if(this.gui==null||!this.gui.blocking){this.postGuiUpdate()}if(this.gui!=null){let value=this.gui.update();if(value!=0){if(this.gui.blocking)this.onGuiEnd();this.gui.destroy();this.gui=null;Scumbag.Script.runScript(value)}}}buildTextbox(heading,content,chipKey){let head=new Scumbag.TextElement(this.game,heading,headingFont);let text=new Scumbag.TextElement(this.game,content,bodyFont,true);let clicker=new Scumbag.ClickerElement(this.game,"clicker");this.setGui(new Scumbag.Window(this.game,"window",new Array(head,text,clicker),chipKey))}buildQA(question,chipKey,...answers){let head=new Scumbag.TextElement(this.game,question,questionFont);let body=new Array(answers.length);for(let i=0;i<body.length;i++){body[i]=new Scumbag.TextElement(this.game,answers[i],bodyFont)}let selector=new Scumbag.SelectorElement(this.game,"selector",body);this.setGui(new Scumbag.Window(this.game,"window",new Array(head,selector),chipKey))}buildPause(question,...answers){let head=new Scumbag.TextElement(this.game,question,questionFont);let body=new Array(answers.length);for(let i=0;i<body.length;i++){body[i]=new Scumbag.TextElement(this.game,answers[i],bodyFont)}let pics=[];for(let u=0;u<Scumbag.StateOfGame.parameters.characters.length;u++){pics[u]=new Scumbag.ImageElement(this.game,Scumbag.StateOfGame.parameters.characters[u])}pics[Scumbag.StateOfGame.parameters.characters.length]=new Scumbag.SelectorElement(this.game,"selector",body);let shelf=new Scumbag.ShelfElement(pics);this.setGui(new Scumbag.Window(this.game,"window",new Array(head,shelf)))}buildSlot(cancelFirst=false){let children=[];for(let i=0;i<N_SAVES;i++){let head=new Scumbag.TextElement(this.game,"Slot "+(i+1),headingFont);Scumbag.StateOfGame.load(i+1);let pics=[];for(let u=0;u<Scumbag.StateOfGame.parameters.characters.length;u++){pics[u]=new Scumbag.ImageElement(this.game,Scumbag.StateOfGame.parameters.characters[u])}if(pics.length==0){pics[0]=new Scumbag.ImageElement(this.game,"new")}let time=new Scumbag.TextElement(this.game,numberAsTime(Scumbag.StateOfGame.parameters.time),bodyFont);let details=new Scumbag.StackElement([time]);pics[pics.length]=details;let body=new Scumbag.ShelfElement(pics);children[i]=new Scumbag.StackElement([head,body])}let cancelText=new Scumbag.TextElement(this.game,"Cancel",headingFont);let cancelPic=new Scumbag.ImageElement(this.game,"cancel");if(cancelFirst){children=[new Scumbag.StackElement([cancelText,cancelPic])].concat(children)}else{children[N_SAVES]=new Scumbag.StackElement([cancelText,cancelPic])}let slots=new Scumbag.SlotElement(this.game,"selector",children);this.setGui(new Scumbag.Window(this.game,"window",[slots]));Scumbag.StateOfGame.flush()}buildWaiter(actorPaths,colour=-1,time=0){this.setGui(new Scumbag.Waiter(this.game,actorPaths,colour,time))}setGui(gui){this.gui=gui;this.gui.addPosition(this.game.camera.x,this.game.camera.y);if(this.gui.blocking)this.onGuiStart()}}Scumbag.GuiState=GuiState})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){const PADDING=40;let headingFont={font:"50px Serif",fontStyle:"bold",fill:"#f00",stroke:"#00f",strokeThickness:5};let bodyFont={font:"20px Serif",fill:"#ff6",align:"center",wordWrap:true,wordWrapWidth:0};let outside;let stop=false;function move(a){a.y-=.6;if(a.y>0)outside=false}class Credits extends Phaser.State{create(){let data=this.game.cache.getJSON("credits");this.background=this.add.sprite(0,0,data.background);Scumbag.MusicManager.stopSong(Scumbag.MusicChannel.Ambience);Scumbag.MusicManager.playSong(this.game,data.music,Scumbag.MusicChannel.Music);bodyFont.wordWrapWidth=this.game.width;this.items=this.game.add.group();let y=this.game.height;for(let i=0;i<data.items.length;i++){let item;if(data.items[i].type=="text"){item=this.game.add.text(this.game.width/2,y,data.items[i].content,bodyFont)}else if(data.items[i].type=="heading"){item=this.game.add.text(this.game.width/2,y,data.items[i].content,headingFont);item.setShadow(0,0,"rgba(0,1,0,1)",5);item.update=function(){this.strokeThickness=Math.random()*36+Math.sin(this.y/8)*20}}else if(data.items[i].type=="image"){item=this.game.add.image(this.game.width/2,y,data.items[i].content)}else if(data.items[i].type=="score"){item=this.game.add.text(this.game.width/2,y,"your score is "+Scumbag.StateOfGame.parameters.score,bodyFont)}item.anchor.setTo(.5,0);this.items.add(item);y+=item.height+PADDING}}update(){outside=true;this.items.forEach(move,null);if(outside&&!stop){let tween=this.add.tween(this.background).to({alpha:0},2e3,Phaser.Easing.Default,true);tween.onComplete.add(function(){this.game.state.start("MainMenu",true,false)},this);stop=true}}}Scumbag.Credits=Credits})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){const MAX_FIGHTERS=40;const NAME_TAG_STYLE={font:"16px Serif",fontStyle:"bold",fill:"#fff",backgroundColor:"#f00"};class Fight extends Phaser.State{constructor(){super(...arguments);this.background=null}init(map){this.map=map}preload(){if(!this.game.cache.checkTilemapKey(this.map)){this.game.load.tilemap(this.map,"maps/"+this.map+".json",null,Phaser.Tilemap.TILED_JSON)}}create(){this.tilemap=this.add.tilemap(this.map);this.tilemap.addTilesetImage("combatTiles","combatTiles");this.tilemap.createLayer("background");this.collisionLayer=this.tilemap.createLayer("collisions");this.tilemap.setLayer(this.collisionLayer);this.tilemap.setCollisionBetween(0,6569);this.collisionLayer.resizeWorld();if(this.tilemap.properties.hasOwnProperty("background")){if(this.tilemap.properties.background!=""){this.background=new Scumbag.Background(this.tilemap.properties.background,this.tilemap.width*this.tilemap.tileWidth,this.tilemap.height*this.tilemap.tileHeight,this.game)}}if(this.tilemap.properties.hasOwnProperty("music")){Scumbag.MusicManager.playSong(this.game,this.tilemap.properties.music,Scumbag.MusicChannel.Music)}this.game.physics.startSystem(Phaser.Physics.ARCADE);this.bullets=this.game.add.group();this.fighters=this.game.add.group();let enemies=this.tilemap.objects["enemies"];for(let i in enemies){let x=enemies[i].x+enemies[i].width/2;let y=enemies[i].y+enemies[i].height/2;let type=enemies[i].properties.kind;let mandatory=false;if(enemies[i].properties.hasOwnProperty("mandatory")){mandatory=enemies[i].properties.mandatory}this.fighters.add(Scumbag.createFighterFromEnemy(type,x,y,mandatory,this.bullets,this.game))}this.healthBar=this.game.add.image(0,0,"healthBar");this.manaBar=this.game.add.image(0,this.healthBar.height,"manaBar");this.nameTag=this.game.add.text(0,this.healthBar.height+this.manaBar.height,"",NAME_TAG_STYLE);this.nameTag.fixedToCamera=true;this.healthBar.fixedToCamera=true;this.manaBar.fixedToCamera=true;let playerRegion=this.tilemap.objects["player"][0];this.playerX=playerRegion.x+playerRegion.width/2;this.playerY=playerRegion.y+playerRegion.height/2;this.playerDeaths=0;this.addPlayer()}update(){if(this.background!=null){this.background.update(this.camera.x,this.camera.y)}this.game.physics.arcade.collide(this.fighters,this.collisionLayer,fighterHitLevel,null,this);for(let child of this.bullets.children){if(child instanceof Scumbag.Weapon){this.game.physics.arcade.collide(child,this.collisionLayer,hitLevel,null,this);for(let fighter of this.fighters.children){if(fighter instanceof Scumbag.Fighter){if(fighter!=child.master){this.game.physics.arcade.collide(fighter,child,hitFighter)}else{this.game.physics.arcade.collide(fighter,child,null,hitMaster)}}}}}this.game.physics.arcade.collide(this.fighters,this.player,hitPlayer);this.healthBar.scale.x=this.player.health/this.player.maxHealth;this.manaBar.scale.x=this.player.mana/this.player.maxMana;if(!this.player.alive)this.addPlayer();let stay=false;for(let fighter of this.fighters.children){if(fighter instanceof Scumbag.Fighter){if(fighter.alive&&fighter.mandatory)stay=true}}if(!stay){this.game.state.start("Overworld")}}render(){}addFighter(type,x,y){if(this.fighters.length>=MAX_FIGHTERS)return;this.fighters.add(Scumbag.createFighterFromEnemy(type,x,y,false,this.bullets,this.game))}addPlayer(){if(this.player!=null){this.player.destroy();Scumbag.StateOfGame.parameters.score-=6.4}if(this.playerDeaths==Scumbag.StateOfGame.parameters.characters.length){this.game.state.start("Gameover");return}let character=Scumbag.StateOfGame.parameters.characters[this.playerDeaths];this.nameTag.text=character;this.player=Scumbag.createFighterFromEnemy(character,this.playerX,this.playerY,false,this.bullets,this.game);this.game.camera.follow(this.player);this.fighters.add(this.player);this.playerDeaths++}}Scumbag.Fight=Fight;function fighterHitLevel(actor,tile){if(tile.properties.damage>0){actor.damage(tile.properties.damage);return false}return true}function hitLevel(bullet,tile){if(!bullet.bouncy){bullet.kill();if(tile.properties.destructible==1){this.tilemap.removeTile(tile.x,tile.y,this.collisionLayer)}return false}return true}function hitFighter(fighter,bullet){if(!bullet.collide)return false;fighter.damage(bullet.power);Scumbag.StateOfGame.parameters.score++;bullet.kill();return true}function hitMaster(fighter,bullet){return!bullet.collide}function hitPlayer(player,enemy){if(player==enemy)return;player.damage(enemy.collisionDamage)}})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class Gameover extends Scumbag.GuiState{create(){this.game.camera.x=0;this.game.camera.y=0;this.background=this.add.sprite(0,0,"titlepage");this.background.alpha=0;this.logo=this.add.sprite(this.game.width/2,-300,"dead");this.logo.anchor.setTo(.5,.5);this.add.tween(this.background).to({alpha:1},500,Phaser.Easing.Default,true);this.add.tween(this.logo).to({y:this.game.height/2-this.logo.height/2},700,Phaser.Easing.Elastic.In,true,500);Scumbag.MusicManager.playSong(this.game,"deadMusic",Scumbag.MusicChannel.Music);Scumbag.Script.setScript(this.game.cache.getText("deadScript"))}postGuiUpdate(){}onGuiStart(){}onGuiEnd(){}}Scumbag.Gameover=Gameover})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class MainMenu extends Scumbag.GuiState{create(){this.background=this.add.sprite(0,0,"titlepage");this.background.alpha=0;this.logo=this.add.sprite(this.game.width/2,this.game.height/2,"logo");this.logo.anchor.setTo(.5,.8);this.logo.animations.add("play",[0,1,2,3],7,true);this.logo.animations.play("play");this.logo.alpha=0;this.add.tween(this.background).to({alpha:1},500,Phaser.Easing.Default,true);this.add.tween(this.logo).to({alpha:1},800,Phaser.Easing.Default,true,500);Scumbag.MusicManager.stopSong(Scumbag.MusicChannel.Ambience);Scumbag.MusicManager.playSong(this.game,"scumtime",Scumbag.MusicChannel.Music);Scumbag.InputManager.init(this.game);Scumbag.StateOfGame.flush();Scumbag.StateOfGame.stopTimer();Scumbag.Script.init(this.game);Scumbag.Script.setScript(this.game.cache.getText("menuScript"))}postGuiUpdate(){}onGuiStart(){}onGuiEnd(){}}Scumbag.MainMenu=MainMenu})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){function touches(a,b){if(a.moveMode==Scumbag.MovementMode.TemporaryPath||b.moveMode==Scumbag.MovementMode.TemporaryPath||a.getPage().autorun||b.getPage().autorun||this.collideCooldown>0){return true}if(a==this.player&&b.getPage().script!=""){this.player.body.immovable=false;this.collideCooldown=1;Scumbag.Script.setScript(b.getPage().script,b)}else if(b==this.player&&a.getPage().script!=""){this.player.body.immovable=false;this.collideCooldown=1;Scumbag.Script.setScript(a.getPage().script,a)}return true}function pause(){if(this.gui!=null)return;Scumbag.Script.setScript(this.game.cache.getText("saveScript"))}function addPlayerAtRegion(game,region,key){let x=region.x+region.width/2;let y=region.y+region.height/2;let page=new Scumbag.Page;page.key=Scumbag.StateOfGame.parameters.playerKey;let player=new Scumbag.Actor(game,x,y,"player",[page]);player.moveMode=Scumbag.MovementMode.PlayerControlled;return player}class Overworld extends Scumbag.GuiState{constructor(){super(...arguments);this.background=null;this.overlay=null;this.collideCooldown=0}init(map=null,playerRegion){this.playerRegion=playerRegion;if(map==null){this.map=Scumbag.StateOfGame.parameters.map;this.returning=true}else{this.map=map;this.returning=false}}preload(){if(!this.game.cache.checkTilemapKey(this.map)){this.game.load.tilemap(this.map,"maps/"+this.map+".json",null,Phaser.Tilemap.TILED_JSON)}}create(){super.create();Scumbag.StateOfGame.parameters.map=this.map;this.game.physics.startSystem(Phaser.Physics.ARCADE);this.tilemap=this.add.tilemap(this.map);for(let i in this.tilemap.tilesets){this.tilemap.addTilesetImage(this.tilemap.tilesets[i].name,this.tilemap.tilesets[i].name)}this.collisionLayer=this.tilemap.createLayer("collisions");this.tilemap.setLayer(this.collisionLayer);this.tilemap.setCollisionBetween(0,6569);this.collisionLayer.resizeWorld();this.collisionLayer.visible=false;this.tilemap.createLayer("background");this.tilemap.createLayer("things");this.regions=Scumbag.createRegions(this.tilemap.objects["regions"]);if(this.playerRegion==null){let page=new Scumbag.Page;page.key=Scumbag.StateOfGame.parameters.playerKey;this.player=new Scumbag.Actor(this.game,0,0,"player",[page]);this.player.moveMode=Scumbag.MovementMode.PlayerControlled;this.player.body.immovable=false}else{this.player=addPlayerAtRegion(this.game,this.regions[this.playerRegion],Scumbag.StateOfGame.parameters.playerKey)}this.actors=this.game.add.group();this.actors.add(this.player);let actors=this.tilemap.objects["actors"];for(let i in actors){let x=actors[i].x+actors[i].width/2;let y=actors[i].y+this.tilemap.tileHeight-actors[i].height/2;let name=actors[i].name;let actor=new Scumbag.Actor(this.game,x,y,name,Scumbag.createPages(actors[i].properties.pages,name,this.tilemap.key,this.regions));this.actors.add(actor)}if(this.returning){this.restoreActors()}this.tilemap.createLayer("overhead");this.game.camera.follow(this.player);this.game.camera.focusOnXY(this.player.position.x,this.player.position.y);if(Scumbag.Script.checkPaused())Scumbag.Script.runScript(0);if(this.tilemap.properties!=null){if(this.tilemap.properties.hasOwnProperty("music")){if(this.tilemap.properties.music=="none")Scumbag.MusicManager.stopSong(Scumbag.MusicChannel.Music);else Scumbag.MusicManager.playSong(this.game,this.tilemap.properties.music,Scumbag.MusicChannel.Music)}if(this.tilemap.properties.hasOwnProperty("ambience")){if(this.tilemap.properties.ambience=="none")Scumbag.MusicManager.stopSong(Scumbag.MusicChannel.Ambience);else Scumbag.MusicManager.playSong(this.game,this.tilemap.properties.ambience,Scumbag.MusicChannel.Ambience)}else{Scumbag.MusicManager.stopSong(Scumbag.MusicChannel.Ambience)}if(this.tilemap.properties.hasOwnProperty("background")){if(this.tilemap.properties.background!=""){this.background=new Scumbag.Background(this.tilemap.properties.background,this.tilemap.width*this.tilemap.tileWidth,this.tilemap.height*this.tilemap.tileHeight,this.game);this.background.update(this.camera.x,this.camera.y)}}if(this.tilemap.properties.hasOwnProperty("overlay")){let overlayData=this.tilemap.properties.overlay.split(",");this.overlayDriftX=overlayData[1];this.overlayDriftY=overlayData[2];this.overlay=this.game.add.tileSprite(0,0,this.game.width,this.game.height,overlayData[0]);this.overlay.fixedToCamera=true;this.overlay.blendMode=PIXI.blendModes.MULTIPLY}}let device=Scumbag.InputManager.getInputDevice(0);device.addOnButtonPress(1,pause,this);Scumbag.StateOfGame.startTimer()}render(){}shutdown(){let device=Scumbag.InputManager.getInputDevice(0);device.clear()}postGuiUpdate(){this.actors.sort("y",Phaser.Group.SORT_ASCENDING);if(this.background!=null){this.background.update(this.camera.x,this.camera.y)}if(this.overlay!=null&&this.overlay.tilePosition!=null){this.overlay.tilePosition.x+=this.overlayDriftX*this.game.time.elapsedMS/1e3;this.overlay.tilePosition.y+=this.overlayDriftY*this.game.time.elapsedMS/1e3}this.game.physics.arcade.collide(this.actors,this.collisionLayer);this.collideCooldown-=this.game.time.elapsedMS/1e3;this.game.physics.arcade.collide(this.actors,this.actors,touches,null,this);for(let i in this.regions){if(this.regions[i].script!=null){if(this.player.x>this.regions[i].x&&this.player.x<this.regions[i].x+this.regions[i].width&&this.player.y>this.regions[i].y&&this.player.y<this.regions[i].y+this.regions[i].height){Scumbag.Script.setScript(this.regions[i].script)}}}}onGuiStart(){this.player.updating=false;this.actors.setAll("updating",false)}onGuiEnd(){this.player.updating=true;this.actors.setAll("updating",true)}getActorByName(name){for(let i=0;i<this.actors.length;i++){if(this.actors.getAt(i).name==name){return this.actors.getAt(i)}}return null}restoreActors(){for(let i=0;i<Scumbag.StateOfGame.parameters.actors.length;i++){let dude=this.getActorByName(Scumbag.StateOfGame.parameters.actors[i].name);dude.x=Scumbag.StateOfGame.parameters.actors[i].x;dude.y=Scumbag.StateOfGame.parameters.actors[i].y}}transition(map){this.onGuiStart();let transitioner=this.add.image(this.camera.x+this.game.width/2,this.camera.y+this.game.height/2,"transition");transitioner.anchor.setTo(.5,.5);let tween=this.add.tween(transitioner.scale).to({x:30,y:30},700,Phaser.Easing.Default,true);this.add.tween(transitioner).to({angle:1e3},700,Phaser.Easing.Default,true);tween.onComplete.add(function(){this.game.state.start("Fight",true,false,map)},this);this.game.sound.play("swish")}}Scumbag.Overworld=Overworld})(Scumbag||(Scumbag={}));var Scumbag;(function(Scumbag){class Preloader extends Phaser.State{preload(){this.preloadBar=this.add.sprite(0,0,"preloadBar");this.load.setPreloadSprite(this.preloadBar);this.game.load.pack("main","pack.json")}create(){var tween=this.add.tween(this.preloadBar).to({alpha:0},1e3,Phaser.Easing.Linear.None,true);tween.onComplete.add(this.startMainMenu,this)}startMainMenu(){this.game.state.start("MainMenu",true,false)}}Scumbag.Preloader=Preloader})(Scumbag||(Scumbag={}));